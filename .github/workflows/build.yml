name: 🔨 构建和测试

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: 📥 检出代码
        uses: actions/checkout@v4

      - name: 📦 设置Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: 🔧 安装根目录依赖
        run: npm ci

      - name: 🔧 安装前端依赖
        working-directory: ./frontend
        run: npm ci

      - name: 🔧 安装后端依赖
        working-directory: ./backend
        run: npm ci

      - name: 🔨 构建前端
        working-directory: ./frontend
        run: npm run build

      - name: 🧪 测试构建结果
        run: |
          echo "✅ 前端构建成功"
          echo "✅ 后端依赖安装成功"
          echo "✅ 项目测试通过"
          ls -la frontend/dist/

      - name: 📦 上传构建产物
        uses: actions/upload-artifact@v4
        with:
          name: frontend-dist
          path: frontend/dist
          retention-days: 7

      - name: 📋 部署状态
        run: |
          echo "🎉 构建完成！"
          echo "📁 前端构建文件已保存"
          echo "🚀 可以手动部署到云平台" 